{"name":"Múltipla Iniciativa","type":"script","scope":"global","author":"zypc4ueMMbKFzteu","img":"icons/svg/combat.svg","command":"// Usável para adicionar múltiplas iniciativas a chefões!\n\nconst combat = game.combat;\nif(token && combat) {\n  let create = {\n    tokenId: token.id,\n    sceneId: token.scene.id,\n    actorId: token.actor.id,\n    hidden: token.document.hidden\n  };\n  await combat.createEmbeddedDocuments(\"Combatant\", [create]);\n}","ownership":{"default":0,"izTN2S0Mlytej3sI":3,"zypc4ueMMbKFzteu":3},"flags":{"core":{"sourceId":"Macro.bGbfBnb4g3nN4jDo"}},"_stats":{"systemId":"tormenta20","systemVersion":"1.4.002","coreVersion":"10.285","createdTime":1658360179912,"modifiedTime":1662866680923,"lastModifiedBy":"zypc4ueMMbKFzteu"},"folder":null,"sort":0,"_id":"XestvQo5XODrRth4"}
{"name":"Confuso","type":"script","author":"zypc4ueMMbKFzteu","img":"systems/tormenta20/icons/conditions/confuso.svg","scope":"global","command":"// Macro desenvolvida por Sapodinho#0859 inspirado no exemplo de BrunoCF086#7267.\n// Teste de Morte do Tormenta20;\n(async () => {\n\tif (!token) {\n\t\tui.notifications.warn(\"Nenhum personagem selecionado!\");\n\t\treturn;\n\t}\n\tconst rollData = token.actor.getRollData();\n\tlet rolls = [];\n\t//const testeMorte = await new Roll(`1d20 + @con`, token.actor.getRollData()).evaluate();\n\tconst d6 = await game.tormenta20.dice.d20Roll({parts:['1d6']});\n\td6.options.title = 'Confusão'\n\trolls.push(d6);\n\tif ( d6.total == 1 ){\n\t\tconst d8 = await game.tormenta20.dice.d20Roll({parts:['1d8']});\n\t\td8.options.title = 'Direção'\n\t\trolls.push(d8);\n\t}\n\tfunction tabela(rolls) {\n\t\tlet dado = rolls[0].total;\n\t\tif (dado == 1) {\n\t\t\treturn tabela2(rolls)\n\t\t}\n\t\telse if (dado == 2 || dado == 3) return \"Não pode fazer ações, exceto reações, e fica balbuciando incoerentemente\";\n\t\telse if (dado == 4 || dado == 5) return \"Usa a arma que estiver empunhando para atacar a criatura mais próxima, ou a si mesmo se estiver sozinho (apenas role o dano)\";\n\t\telse if (dado == 6) return \"A condição termina e pode agir normalmente\";\n\t}\n\tfunction tabela2(rolls) {\n\t\tlet dado = rolls[1].total;\n\t\tconst direcoes = [\"cima\", \"o canto superior-direito\", \"direita\", \"o canto inferior-direito\", \"baixo\", \"o canto inferior-esquerdo\", \"esquerda\", \"o canto superior esquerdo\"]\n\t\treturn \"Movimenta-se para \" + direcoes[dado];\n\t}\n\tlet resultado = tabela(rolls);\n\t\n\tconst messageData = {\n\t\trolls: rolls,\n\t\ttemplateData: { item: { name: \"Confuso\", img: \"systems/tormenta20/icons/conditions/confuso.svg\" }, system: { description: { value: \"<p>\" + resultado + \". </p>\" } } }\n\t}\n\n\tgame.tormenta20.macros.rollChatMessage(messageData);\n})();","flags":{"core":{"sourceId":"Macro.OK6TesXExvWxoBbn"}},"ownership":{"default":0,"0bS8PF9mUpBd2z0H":3,"zypc4ueMMbKFzteu":3},"_stats":{"systemId":"tormenta20","systemVersion":"1.4.002","coreVersion":"10.285","createdTime":1662828138713,"modifiedTime":1662923793361,"lastModifiedBy":"izTN2S0Mlytej3sI"},"folder":null,"sort":0,"_id":"aPUaPZpBf72hmjOp"}
{"name":"Condições","type":"script","author":"zypc4ueMMbKFzteu","img":"icons/svg/aura.svg","scope":"global","command":"/**\n * Maneira rapida de enviar textos informativos sobre as Condições no chat\n * Autor: Tiago Morato\n */\n\nnew Dialog({\n  title: `Condições`,\n  content: `<style>\n\n  button{\n      border: none\n  }\n  \n button:hover{\n    cursor: pointer;\n  }\n  .autor {\n      flex-flow: row-reverse;\n      text-align: right;\n  }\n  \n    h3{\n      font-size: 1rem\n  }\n  \n  .container{\n    display: flex;\n    margin-bottom: 0.2rem\n}\n\n\n.medo{\nbackground: linear-gradient(90deg, #000000 15%, #ddd9d5 10%);\nborder: solid 2px #000000;\nfont-size: 0.9rem;\n}\n.paralisia{\nbackground: linear-gradient(90deg, #435178 15%, #ddd9d5 10%);\nborder: solid 2px #435178;\nfont-size: 0.9rem;\n}\n.mental{\nbackground: linear-gradient(90deg, #7542f5 15%, #ddd9d5 10%);\nborder: solid 2px #7542f5;\nfont-size: 0.9rem;\n}\n.fisica{\nbackground: linear-gradient(90deg, #b02b2e 15%, #ddd9d5 10%);\nborder: solid 2px #b02b2e;\nfont-size: 0.9rem;\n}\n.fadiga{\nbackground: linear-gradient(90deg, #7c8a6f 15%, #ddd9d5 10%);\nborder: solid 2px #7c8a6f;\nfont-size: 0.9rem;\n}\n.sentidos{\nbackground: linear-gradient(90deg, #40916c 15%, #ddd9d5 10%);\nborder: solid 2px #40916c;\nfont-size: 0.9rem;\n}\n.semtipo{\nbackground: linear-gradient(90deg, #7d7d7d 15%, #ddd9d5 10%);\nborder: solid 2px #7d7d7d;\nfont-size: 0.9rem;\n}\n  \n \n  \n </style>\n      <h1>Condições</h1>\n      <div>\n        <div class=\"container\">\n            <button class=\"medo\" onclick=\"toChat('Abalado')\">Abalado</button>\n            <button class=\"paralisia\" onclick=\"toChat('Agarrado')\">Agarrado</button>\n            <button class=\"mental\" onclick=\"toChat('Alquebrado')\">Alquebrado</button>\n        </div>\n        <div class=\"container\">\n            <button class=\"medo\" onclick=\"toChat('Apavorado')\">Apavorado</button>\n            <button class=\"mental\"  onclick=\"toChat('Atordoado')\">Atordoado</button>\n            <button class=\"fisica\" onclick=\"toChat('Caído')\">Caído</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"fisica\" onclick=\"toChat('Cego')\">Cego</button>\n            <button class=\"mental\" onclick=\"toChat('Confuso')\">Confuso</button>\n             <button class=\"fisica\" onclick=\"toChat('Debilitado')\">Debilitado</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"fisica\" onclick=\"toChat('Desprevenido')\">Desprevenido</button>\n            <button class=\"fisica\" onclick=\"toChat('Doente')\">Doente</button>\n            <button class=\"fisica\" onclick=\"toChat('Em Chamas')\">Em Chamas</button>\n         </div>\n        <div class=\"container\">\n             <button class=\"fisica\" onclick=\"toChat('Enjoado')\">Enjoado</button>\n            <button class=\"paralisia\" onclick=\"toChat('Enredado')\">Enredado</button>\n            <button class=\"fisica\" onclick=\"toChat('Envenenado')\">Envenenado</button>\n         </div>\n        <div class=\"container\">\n           <button class=\"mental\" onclick=\"toChat('Esmorecido')\">Esmorecido</button>\n           <button class=\"fadiga\" onclick=\"toChat('Exausto')\">Exausto</button>\n            <button class=\"mental\" onclick=\"toChat('Fascinado')\">Fascinado</button>\n         </div>\n         <div class=\"container\">\n            <button class=\"fadiga\" onclick=\"toChat('Fatigado')\">Fatigado</button>\n            <button class=\"fisica\" onclick=\"toChat('Fraco')\">Fraco</button>\n            <button class=\"mental\" onclick=\"toChat('Frustrado')\">Frustrado</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"paralisia\" onclick=\"toChat('Imóvel')\">Imóvel</button>\n            <button class=\"fisica\" onclick=\"toChat('Inconsciente')\">Inconsciente</button>\n            <button class=\"semtipo\" onclick=\"toChat('Indefeso')\">Indefeso</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"paralisia\" onclick=\"toChat('Lento')\">Lento</button>\n            <button class=\"sentidos\" onclick=\"toChat('Ofuscado')\">Ofuscado</button>\n            <button class=\"paralisia\" onclick=\"toChat('Paralisado')\">Paralisado</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"mental\" onclick=\"toChat('Pasmo')\">Pasmo</button>\n            <button class=\"semtipo\" onclick=\"toChat('Petrificado')\">Petrificado</button>\n            <button class=\"semtipo\" onclick=\"toChat('Sangrando')\">Sangrando</button>\n         </div>\n        <div class=\"container\">\n            <button class=\"sentidos\" onclick=\"toChat('Surdo')\">Surdo</button>\n            <button class=\"fisica\" onclick=\"toChat('Surpreendido')\">Surpreendido</button>\n            <button class=\"fisica\"  onclick=\"toChat('Vulnerável')\">Vulnerável</button>\n      </div>\n      <div style=\"margin-top: 1rem\">\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#000000\"/>\n</svg><h3>Condição de Medo</h3>\n      </div>\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#435178\"/>\n</svg><h3>Condição de Paralisia</h3>\n      </div>\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#7542f5\"/>\n</svg><h3>Condição Mental</h3>\n      </div>\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#b02b2e\"/>\n</svg><h3>Condição Física</h3>\n      </div>\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#7c8a6f\"/>\n</svg><h3>Condição de Fadiga</h3>\n      </div>\n      <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#40916c\"/>\n</svg><h3>Condição de Sentidos</h3>\n      </div>\n       <div class=\"container\">\n      <svg width=\"25\" height=\"25\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n  <rect x=\"0\" y=\"00\" rx=\"10\" ry=\"10\" width=\"20\" height=\"20\" fill=\"#7d7d7d\"/>\n</svg><h3>Condição sem Tipo</h3>\n      </div>\n      <div class=\"container autor\">\n      <small>Autor: Tiago Morato</small>\n      </div>\n</div>\n<script>\n    function toChat(condicao = 'Abalado'){\n        game.tormenta20.macros.msgFromJournal(condicao, \"tormenta20.condicoes\");\n    }\n</script>\n    `,\n    buttons: {\n        no: {\n            icon: \"<i class='fas fa-times'></i>\",\n            label: `Fechar`,\n            callback: () => close\n        },\n    },\n}).render(true);","flags":{"core":{"sourceId":"Macro.VPR2pxVCU1SHbyyx"}},"ownership":{"default":0,"0bS8PF9mUpBd2z0H":3,"zypc4ueMMbKFzteu":3},"_stats":{"systemId":"tormenta20","systemVersion":"1.4.002","coreVersion":"10.285","createdTime":1662828140733,"modifiedTime":1662866673118,"lastModifiedBy":"zypc4ueMMbKFzteu"},"folder":null,"sort":0,"_id":"hE9CQrXt4U0SRRVt"}
{"name":"Sangrando","type":"script","author":"zypc4ueMMbKFzteu","img":"icons/svg/blood.svg","scope":"global","command":"// Macro desenvolvida por Sapodinho#0859 inspirado no exemplo de BrunoCF086#7267.\n// Teste de Morte do Tormenta20;\n(async () => {\n\tif (!token) {\n\t\tui.notifications.warn(\"Nenhum personagem selecionado!\");\n\t\treturn;\n\t}\n\tconst rollMode = game.settings.get(\"core\", \"rollMode\");\n\tconst rollData = token.actor.getRollData();\n\tlet rolls = [];\n\t//const testeMorte = await new Roll(`1d20 + @con`, token.actor.getRollData()).evaluate();\n\tconst testeMorte = await game.tormenta20.dice.d20Roll({parts:['1d20','@con'], data: rollData, targetValue:15});\n\ttesteMorte.options.title = 'Teste de Constituição';\n\trolls.push(testeMorte);\n\t\n\tif (testeMorte.total < 15) {\n\t\t//let dano = await new Roll(`1d6[perda]`).evaluate();\n\t\tconst dano = await game.tormenta20.dice.damageRoll({parts:[['1d6','perda']]});\n\t        dano.options.title = 'Dano';\n\t\trolls.push(dano);\n\t}\n\tconst messageData = {\n\t\trolls: rolls,\n\t\ttemplateData: { item: { name: \"Teste de Morte\", img: \"icons/svg/blood.svg\" }, system: { description: { value: \"<p style='text-align:justify'>Se ficar com 0 PV ou menos, você cai inconsciente e começa a sangrar. No início de seu turno, faça um teste de Constituição (CD 15). Se passar, você estabiliza e não precisa mais fazer esse teste. Se falhar, você perde 1d6 pontos de vida e continua sangrando. Você deve repetir o teste a cada rodada, até estabilizar ou morrer. Um personagem sangrando pode ser estabilizado com um teste de Cura (CD 15) ou com qualquer efeito que cure pelo menos 1 PV.</p>\" } } }\n\t}\n\n\tgame.tormenta20.macros.rollChatMessage(messageData);\n})();","flags":{"core":{"sourceId":"Macro.TR2jZSmmys915xUD"}},"ownership":{"default":0,"0bS8PF9mUpBd2z0H":3,"zypc4ueMMbKFzteu":3},"_stats":{"systemId":"tormenta20","systemVersion":"1.4.002","coreVersion":"10.285","createdTime":1662828133854,"modifiedTime":1662923863998,"lastModifiedBy":"izTN2S0Mlytej3sI"},"folder":null,"sort":0,"_id":"tQeffiTPwX7DPiM0"}
{"name":"Descanso","type":"script","author":"zypc4ueMMbKFzteu","img":"icons/svg/regen.svg","scope":"global","command":"// Obs: isso não leva em conta habilidades (ex: Osteon, Golem e a origem Refugiado).\n//Selecione os tokens que devem descansar e use a macro.\n(async () => {\n  if (!token) {\n    ui.notifications.warn(\"Nenhum personagem selecionado!\");\n    return;\n  }\n  \n  async function descanso(modificador, modPV, modPM, curaCP=0, curaAC=0){\n    let msg = [];\n    \n    for (let e of canvas.tokens.controlled) {\n        if( !e.actor ) continue;\n        let m = await e.actor.descanso(modificador, modPV, modPM, curaCP, curaAC, false);\n        msg.push(m);\n    }\n    let descricao = '';\n    const condicao = [\"Ruim\", \"Normal\", \"Confortável\", \"Luxuoso\"];\n    let c = condicao[Math.floor(modificador)];\n    descricao += `<span>Condição ${c}: ${modificador}/nivel</span><br>`;\n    if(modPV){\n        descricao += `<span>Extra PV: ${modPV}/nivel</span><br>`;\n    }\n    if(modPM){\n        descricao += `<span>Extra PM: ${modPM}/nivel</span><br>`;\n    }\n    if(curaCP){\n        descricao += `<span>Cuidados Rolongados (+1 PV/Nível)</span><br>`;\n    }\n\tif(curaAC){\n        descricao += `<span>Acompanhamento Médico (+1 PV/Nível)</span><br>`;\n    }\n    descricao += \"<p>\" + msg.join('<br>') + \"</p>\";\n    let content = {\n\t\titem: {\n\t\t\tname: \"Descanso\",\n\t\t\timg: \"icons/svg/regen.svg\"\n\t\t},\n\t\tsystem: {\n\t\t\tdescription: {\n\t\t\t\tvalue: descricao\n\t\t\t}\n\t\t}\n\t}\n\tlet template = \"systems/tormenta20/templates/chat/chat-card.html\";\n\tconst html = await renderTemplate(template, content);\n\tconst chatData = {\n\t\tuser: game.user.id,\n\t\ttype: CONST.CHAT_MESSAGE_TYPES.OTHER,\n\t\tcontent: html\n\t};\n\tChatMessage.create(chatData);\n  }\n\n  let content = `<form>\n    <div class=\"form-group\">\n        <label>Qualidade</label> <select name='qualidade'>\n            <option value=0.5>Ruim</option>\n            <option value=1 selected>Normal</option>\n            <option value=2 >Confortável</option>\n            <option value=3>Luxuoso</option>\n        </select>\n    </div>\n    <div class=\"form-group\">\n        <label>PV Extra / Por Nível</label>\n        <input type='number' name='modPV' value='0'>\n    </div>\n    <div class=\"form-group\">\n        <label>PM Extra / Por Nível</label>\n        <input type='number' name='modPM' value='0'>\n    </div>\n    <div class=\"form-group\">\n        <label>Cuidados Prolongados</label>\n        <input type='checkbox' name='curaCP' value=1>\n    </div>\n\t<div class=\"form-group\">\n        <label>Acompanhamento Médico</label>\n        <input type='checkbox' name='curaAC' value=1>\n    </div>\n    </form>`;\n      \n    let dialogEditor = new Dialog({\n    title: `Descanso`,\n    content,\n    buttons: {\n      ok: {\n        label: `OK`,\n        callback: (html) => {\n          const modQ = parseFloat(html.find(\"[name=qualidade]\")[0].value);\n          const modPV = parseInt(html.find(\"[name=modPV]\")[0].value);\n          const modPM = parseInt(html.find(\"[name=modPM]\")[0].value);\n          const curaCP = html.find(\"[name=curaCP]\")[0].checked;\n\t\t  const curaAC = html.find(\"[name=curaAC]\")[0].checked;\n          descanso(modQ, modPV, modPM, curaCP, curaAC);\n          \n        }\n      }\n    },\n    default: \"\",\n    close: () => {}\n    });\n\n    dialogEditor.render(true);\n})();","flags":{"core":{"sourceId":"Macro.jNwovWaSbfSnEssn"}},"ownership":{"default":0,"0bS8PF9mUpBd2z0H":3,"zypc4ueMMbKFzteu":3},"_stats":{"systemId":"tormenta20","systemVersion":"1.4.1002","coreVersion":"10.288","createdTime":1662828137298,"modifiedTime":1666924889308,"lastModifiedBy":"tIn9sSkrT3mDWirx"},"folder":null,"sort":0,"_id":"vjfz3LM1yhNhLo0o"}
