{"version":3,"file":"mobile-improvements.js","sources":["../src/module/preloadTemplates.ts","../src/module/settings.ts","../src/module/windowManager.ts","../src/module/windowMenu.ts","../src/module/about.ts","../src/module/mobileMenu.ts","../src/module/MobileUi.ts","../src/module/util.ts","../src/module/touchInput.ts","../src/mobile-improvements.ts"],"sourcesContent":["export const preloadTemplates = async function (): Promise<unknown> {\r\n  const templatePaths = [\r\n    \"modules/mobile-improvements/templates/window-selector.hbs\",\r\n    \"modules/mobile-improvements/templates/navigation.hbs\",\r\n    \"modules/mobile-improvements/templates/menu.hbs\",\r\n  ];\r\n  return loadTemplates(templatePaths);\r\n};\r\n","const MODULE_NAME = \"mobile-improvements\"; // TODO: Better handling\n\nexport enum settings {\n  // In config\n  SIDEBAR_PAUSES_RENDER = \"sideBarPausesRender\",\n  SHOW_MOBILE_TOGGLE = \"showMobileToggle\",\n  // Not in config\n  SHOW_PLAYER_LIST = \"showPlayerList\",\n  PIN_MOBILE_MODE = \"pinMobileMode\",\n}\n\ninterface Callbacks {\n  [setting: string]: (value) => void;\n}\n\nconst moduleSettings = [\n  {\n    setting: settings.SIDEBAR_PAUSES_RENDER,\n    name: \"MOBILEIMPROVEMENTS.SettingsPauseRendering\",\n    hint: \"MOBILEIMPROVEMENTS.SettingsPauseRenderingHint\",\n    type: Boolean,\n    default: false,\n  },\n  {\n    setting: settings.SHOW_MOBILE_TOGGLE,\n    name: \"MOBILEIMPROVEMENTS.SettingsShowToggle\",\n    hint: \"MOBILEIMPROVEMENTS.SettingsShowToggleHint\",\n    type: Boolean,\n    default: false,\n    scope: \"world\"\n  },\n  {\n    setting: settings.SHOW_PLAYER_LIST,\n    type: Boolean,\n    default: false,\n    config: false,\n  },\n  {\n    setting: settings.PIN_MOBILE_MODE,\n    type: Boolean,\n    default: false,\n    config: false,\n  },\n];\n\nfunction registerSetting(callbacks: Callbacks, { setting, ...options }): void {\n  game.settings.register(MODULE_NAME, setting, {\n    config: true,\n    scope: \"client\",\n    ...options,\n    onChange: callbacks[setting] || undefined,\n  });\n}\n\nexport function registerSettings(callbacks: Callbacks = {}): void {\n  moduleSettings.forEach((item) => {\n    registerSetting(callbacks, item);\n  });\n}\n\nexport function getSetting(setting: settings): any {\n  return game.settings.get(MODULE_NAME, setting as string);\n}\n\nexport function setSetting(setting: settings, value: unknown): Promise<any> {\n  return game.settings.set(MODULE_NAME, setting as string, value);\n}\n","// WindowManager is a singleton that allows management of application windows\nexport function activate(): void {\n  if (!window.WindowManager) {\n    window.WindowManager = new WindowManager();\n  }\n}\n\nexport function getManager(): WindowManager {\n  if (!window.WindowManager) {\n    activate();\n  }\n  return window.WindowManager;\n}\n\nexport class Window {\n  readonly app: Application;\n  constructor(app: Application) {\n    this.app = app;\n  }\n\n  get title(): string {\n    return this.app.title;\n  }\n  get id(): number {\n    return this.app.appId;\n  }\n\n  get minimized(): boolean {\n    // @ts-ignore\n    return this.app._minimized;\n  }\n\n  show(): void {\n    if (this.minimized) {\n      this.app.maximize();\n    }\n    this.app.bringToTop();\n  }\n  minimize(): void {\n    this.app.minimize();\n  }\n  close(): void {\n    this.app.close();\n  }\n}\n\nexport class WindowManager {\n  // All windows\n  windows: { [id: string]: Window } = {};\n  version = \"1.0\";\n  windowChangeHandler: ProxyHandler<any> = {\n    set: (target, property: string, value) => {\n      target[property] = value;\n      this.windowAdded(parseInt(property as string));\n      // Hook for new window being rendered\n      Hooks.once(\"render\" + value.constructor.name, this.newWindowRendered);\n      return true;\n    },\n    deleteProperty: (target, property) => {\n      const res = delete target[property];\n      setTimeout(() => {\n        this.windowRemoved(parseInt(property as string));\n      }, 1);\n      return res;\n    },\n  };\n  constructor() {\n    ui.windows = new Proxy(ui.windows, this.windowChangeHandler);\n    // Override Application bringToTop\n    const old = Application.prototype.bringToTop;\n    const windowBroughtToTop = this.windowBroughtToTop.bind(this);\n    Application.prototype.bringToTop = function () {\n      old.call(this);\n      windowBroughtToTop(this.appId);\n    };\n\n    // Override Application minimize\n    const windowMinimized = this.windowMinimized.bind(this);\n    const oldMinimize = Application.prototype.minimize;\n    Application.prototype.minimize = function () {\n      const r = oldMinimize.call(this);\n      r.then(() => windowMinimized(this.appId));\n      return r;\n    };\n\n    // Override Application maximize\n    const windowMaximized = this.windowMaximized.bind(this);\n    const oldMaximize = Application.prototype.maximize;\n    Application.prototype.maximize = function () {\n      const r = oldMaximize.call(this);\n      r.then(() => windowMaximized(this.appId));\n      return r;\n    };\n\n    console.info(\"Window Manager | Initiated\");\n    Hooks.call(\"WindowManager:Init\");\n  }\n\n  newWindowRendered(app: Application): void {\n    Hooks.call(\"WindowManager:NewRendered\", app.appId);\n  }\n  windowAdded(appId: number): void {\n    this.windows[appId] = new Window(ui.windows[appId]);\n    Hooks.call(\"WindowManager:Added\", appId);\n  }\n  windowRemoved(appId: number): void {\n    delete this.windows[appId];\n    Hooks.call(\"WindowManager:Removed\", appId);\n    this.checkEmpty();\n  }\n  windowBroughtToTop(appId: number): void {\n    Hooks.call(\"WindowManager:BroughtToTop\", appId);\n  }\n\n  windowMinimized(appId: number): void {\n    Hooks.call(\"WindowManager:Minimized\", appId);\n    this.checkEmpty();\n  }\n  windowMaximized(appId: number): void {\n    Hooks.call(\"WindowManager:Maximized\", appId);\n  }\n\n  checkEmpty(): void {\n    const windows = Object.values(this.windows);\n    if (windows.length === 0 || windows.every((w) => w.minimized)) {\n      Hooks.call(\"WindowManager:NoneVisible\");\n    }\n  }\n\n  minimizeAll(): boolean {\n    return Object.values(this.windows).reduce((didMinimize, window) => {\n      didMinimize = didMinimize || !window.minimized;\n      window.minimize();\n      return didMinimize;\n    }, false as boolean);\n  }\n\n  closeAll(): boolean {\n    const closed = Object.keys(this.windows).length != 0;\n    Object.values(this.windows).forEach((window) => {\n      window.close();\n    });\n    return closed;\n  }\n}\n","import { Window } from \"./windowManager\";\r\nimport type { MobileUI } from \"./MobileUi.js\";\r\n\r\nconst icons = {\r\n  \"\": \"\",\r\n  combat: \"fa-fist-raised\",\r\n  scenes: \"fa-map\",\r\n  scene: \"fa-map\",\r\n  actors: \"fa-users\",\r\n  actor: \"fa-users\",\r\n  items: \"fa-suitcase\",\r\n  item: \"fa-suitcase\",\r\n  weapon: \"fa-suitcase\",\r\n  journal: \"fa-book-open\",\r\n  tables: \"fa-th-list\",\r\n  playlists: \"fa-music\",\r\n  compendium: \"fa-atlas\",\r\n  settings: \"fa-cogs\",\r\n  npc: \"fa-skull\",\r\n  character: \"fa-user\",\r\n  spell: \"fa-magic\",\r\n  equipment: \"fa-tshirt\",\r\n  feat: \"fa-hand-rock\",\r\n  class: \"fa-user\",\r\n};\r\n\r\nexport class WindowMenu extends Application {\r\n  list: JQuery<HTMLElement> | null = null;\r\n  nav: MobileUI;\r\n\r\n  constructor(nav: MobileUI) {\r\n    super({\r\n      template: \"modules/mobile-improvements/templates/window-selector.hbs\",\r\n      popOut: false,\r\n    });\r\n    this.nav = nav;\r\n    Hooks.on(\"WindowManager:NewRendered\", this.windowAdded.bind(this));\r\n    Hooks.on(\"WindowManager:Removed\", this.windowRemoved.bind(this));\r\n  }\r\n\r\n  activateListeners(html: JQuery<HTMLElement>): void {\r\n    this.list = html.find(\".window-list\");\r\n  }\r\n\r\n  // Attempt to discern the title and icon of the window\r\n  winIcon(win: any): string {\r\n    let windowType: string =\r\n      win.icon ||\r\n      win.tabName ||\r\n      win.object?.type ||\r\n      win.object?.system?.type ||\r\n      win.object?.system?.entity ||\r\n      (win.metadata ? \"compendium\" : \"\") ||\r\n      \"\";\r\n    windowType = windowType.toLowerCase();\r\n    const icon = icons[windowType] || windowType;\r\n    return icon;\r\n  }\r\n\r\n  newWindow = (win: Window): JQuery<HTMLElement> => {\r\n    const winIcon = this.winIcon(win.app);\r\n    const windowButton = $(\r\n      `<button class=\"window-select\" title=\"${win.title}\"><i class=\"fas ${winIcon}\"></i> ${win.title}</button>`\r\n    );\r\n    const closeButton = $(\r\n      `<button class=\"window-close\" title=\"close\"><i class=\"fas fa-times\"></i></button>`\r\n    );\r\n    const row = $(`<li class=\"window-row\"  data-id=\"${win.id}\"></li>`);\r\n    row.append(windowButton, closeButton);\r\n\r\n    windowButton.on(\"click\", (ev) => {\r\n      ev.preventDefault();\r\n      win.show();\r\n      this.nav.closeDrawer();\r\n    });\r\n    closeButton.on(\"click\", (ev) => {\r\n      ev.preventDefault();\r\n      win.close();\r\n    });\r\n    return row;\r\n  };\r\n  windowAdded(appId: number): void {\r\n    this.list?.append(this.newWindow(window.WindowManager.windows[appId]));\r\n    this.update();\r\n  }\r\n  windowRemoved(appId: number): void {\r\n    this.list?.find(`li[data-id=\"${appId}\"]`).remove();\r\n    this.update();\r\n  }\r\n\r\n  update(): void {\r\n    const winCount = Object.values(window.WindowManager.windows).length;\r\n    this.nav.setWindowCount(winCount);\r\n  }\r\n}\r\n","export class About extends Application {\n  constructor() {\n    super({\n      template: \"modules/mobile-improvements/templates/about.hbs\",\n      id: \"mobile-improvements-about\",\n      title: \"MOBILEIMPROVEMENTS.MenuAbout\",\n      width: 300,\n      height: 260,\n    });\n  }\n\n  activateListeners(html: JQuery<HTMLElement>): void {\n    html.find(\".close-about\").on(\"click\", (evt) => {\n      this.close();\n    });\n  }\n}\n","import type { MobileUI } from \"./MobileUi.js\";\nimport { getSetting, setSetting, settings } from \"./settings.js\";\nimport { About } from \"./about.js\";\nexport class MobileMenu extends Application {\n  nav: MobileUI;\n  aboutApp: About;\n\n  constructor(nav: MobileUI) {\n    super({\n      template: \"modules/mobile-improvements/templates/menu.hbs\",\n      popOut: false,\n    });\n    this.nav = nav;\n    this.aboutApp = new About();\n  }\n  activateListeners(html: JQuery<HTMLElement>): void {\n    html.find(\"li\").on(\"click\", (evt) => {\n      const [firstClass] = evt.currentTarget.className.split(\" \");\n      const [, name] = firstClass.split(\"-\");\n      this.selectItem(name);\n    });\n  }\n\n  toggleOpen(): void {\n    this.element.toggleClass(\"open\");\n  }\n\n  selectItem(name: string): void {\n    switch (name) {\n      case \"about\":\n        this.aboutApp.render(true);\n        break;\n      case \"fullscreen\":\n        if (document.fullscreenElement) {\n          document.exitFullscreen();\n        } else {\n          document.documentElement.requestFullscreen();\n        }\n        break;\n      case \"players\":\n        setSetting(\n          settings.SHOW_PLAYER_LIST,\n          !getSetting(settings.SHOW_PLAYER_LIST)\n        );\n        break;\n      case \"canvas\":\n        game.settings.set(\n          \"core\",\n          \"noCanvas\",\n          !game.settings.get(\"core\", \"noCanvas\")\n        );\n        //@ts-ignore\n        SettingsConfig.reloadConfirm();\n        break;\n      case \"exit\":\n        setSetting(settings.PIN_MOBILE_MODE, false);\n        break;\n      default:\n        console.log(\"Unhandled menu item\", name);\n        break;\n    }\n    this.nav.closeDrawer();\n  }\n}\n","import { settings, getSetting } from \"./settings.js\";\nimport { WindowMenu } from \"./windowMenu.js\";\nimport { MobileMenu } from \"./mobileMenu.js\";\n\nexport enum ViewState {\n  Unloaded,\n  Map,\n  App,\n}\nenum DrawerState {\n  None,\n  Macros = \"macros\",\n  Menu = \"menu\",\n  Windows = \"windows\",\n}\n\nfunction isTabletMode() {\n  return globalThis.MobileMode.enabled && window.innerWidth > 900;\n}\n\nexport class MobileUI extends Application {\n  state: ViewState = ViewState.Unloaded;\n  drawerState: DrawerState = DrawerState.None;\n  noCanvas = false;\n\n  windowMenu: WindowMenu;\n  mobileMenu: MobileMenu;\n\n  constructor() {\n    super({\n      template: \"modules/mobile-improvements/templates/navigation.hbs\",\n      popOut: false,\n    });\n\n    this.windowMenu = new WindowMenu(this);\n    this.mobileMenu = new MobileMenu(this);\n\n    // Ensure HUD shows on opening a new window\n    Hooks.on(\"WindowManager:NewRendered\", () => this._onShowWindow());\n    Hooks.on(\"WindowManager:BroughtToTop\", () => this._onShowWindow());\n    Hooks.on(\"WindowManager:NoneVisible\", () => this._onHideAllWindows());\n  }\n\n  _onShowWindow(): void {\n    $(document.body).removeClass(\"hide-hud\");\n    $(document.body).addClass(\"windows-open\");\n\n    if (isTabletMode()) {\n      this.showSidebar();\n    }\n  }\n\n  _onHideAllWindows(): void {\n    $(document.body).removeClass(\"windows-open\");\n  }\n\n  render(force: boolean, ...arg: unknown[]): unknown {\n    this.noCanvas = game.settings.get(\"core\", \"noCanvas\") as boolean;\n    this.state = this.noCanvas ? ViewState.App : ViewState.Map;\n\n    //@ts-ignore\n    const r = super.render(force, ...arg);\n    this.windowMenu.render(force);\n    this.mobileMenu.render(force);\n    return r;\n  }\n\n  activateListeners(html: JQuery<HTMLElement>): void {\n    html.find(\"li\").on(\"click\", (evt) => {\n      const [firstClass] = evt.currentTarget.className.split(\" \");\n      const [, name] = firstClass.split(\"-\");\n      this.selectItem(name);\n    });\n    this.updateMode();\n    html.before(\n      `<div id=\"show-mobile-navigation\"><i class=\"fas fa-chevron-up\"></i></div>`\n    );\n    html.siblings(\"#show-mobile-navigation\").on(\"click\", () => {\n      $(document.body).toggleClass(\"hide-hud\");\n    });\n    if (this.noCanvas) {\n      this.element.find(\".navigation-map\").detach();\n    }\n  }\n\n  closeDrawer(): void {\n    this.setDrawerState(DrawerState.None);\n  }\n\n  showMap(): void {\n    const minimized = window.WindowManager.minimizeAll();\n    if (!minimized && this.state == ViewState.Map) {\n      $(document.body).toggleClass(\"hide-hud\");\n    }\n    this.state = ViewState.Map;\n    canvas.ready && canvas.app?.start();\n    this.setDrawerState(DrawerState.None);\n    this.updateMode();\n  }\n\n  showSidebar(): void {\n    this.state = ViewState.App;\n    $(document.body).removeClass(\"hide-hud\");\n    ui.sidebar?.expand();\n    if (!isTabletMode()) window.WindowManager.minimizeAll();\n\n    if (getSetting(settings.SIDEBAR_PAUSES_RENDER) === true) {\n      // canvas.ready && canvas.app.stop();\n    }\n    this.setDrawerState(DrawerState.None);\n    this.updateMode();\n  }\n\n  showHotbar(): void {\n    $(document.body).addClass(\"show-hotbar\");\n    ui.hotbar.expand();\n  }\n\n  hideHotbar(): void {\n    $(document.body).removeClass(\"show-hotbar\");\n  }\n\n  setWindowCount(count: number): void {\n    this.element.find(\".navigation-windows .count\").html(count.toString());\n    if (count === 0) {\n      this.element.find(\".navigation-windows\").addClass(\"disabled\");\n    } else {\n      this.element.find(\".navigation-windows\").removeClass(\"disabled\");\n    }\n    if (this.drawerState == DrawerState.Windows) {\n      this.setDrawerState(DrawerState.None);\n    }\n  }\n\n  setDrawerState(state: DrawerState): void {\n    $(`body > .drawer`).removeClass(\"open\");\n    this.element.find(\".toggle.active\").removeClass(\"active\");\n    this.hideHotbar();\n    if (state == DrawerState.None || state == this.drawerState) {\n      this.drawerState = DrawerState.None;\n      return;\n    }\n\n    this.drawerState = state;\n    if (state == DrawerState.Macros) {\n      this.showHotbar();\n    } else {\n      $(`body > .drawer.drawer-${state}`).addClass(\"open\");\n    }\n    this.element.find(`.navigation-${state}`).addClass(\"active\");\n  }\n\n  selectItem(name: string): void {\n    switch (name) {\n      case \"map\":\n        this.showMap();\n        break;\n      case \"sidebar\":\n        this.showSidebar();\n        break;\n      default:\n        this.setDrawerState(name as DrawerState);\n    }\n  }\n\n  updateMode(): void {\n    this.element.find(\".active:not(.toggle)\").removeClass(\"active\");\n    $(document.body).removeClass(\"mobile-app\");\n    $(document.body).removeClass(\"mobile-map\");\n\n    switch (this.state) {\n      case ViewState.Map:\n        this.element.find(\".navigation-map\").addClass(\"active\");\n        $(document.body).addClass(\"mobile-map\");\n        break;\n      case ViewState.App:\n        this.element.find(\".navigation-sidebar\").addClass(\"active\");\n        $(document.body).addClass(\"mobile-app\");\n        break;\n      default:\n        break;\n    }\n  }\n}\n","// https://css-tricks.com/the-trick-to-viewport-units-on-mobile/\nexport function viewHeight(): void {\n  document.documentElement.style.setProperty(\n    \"--vh\",\n    `${Math.min(window.innerHeight, window.outerHeight) * 0.01}px`\n  );\n}\n","declare global {\n  interface LenientGlobalVariableTypes {\n    canvas: never;\n  }\n}\n\nexport class TouchInput {\n  cancelled = false;\n  tapMaxTime = 400;\n  tapStart = -1;\n  tapStartPos = {x: 0, y: 0};\n  touches = 0;\n\n  getTarget(evt: PIXI.InteractionEvent): PlaceableObject | null {\n    let target = evt.target as PlaceableObject;\n    while (!target?.document && target?.parent) {\n      target = target.parent as PlaceableObject;\n    }\n    if (!target.document) {\n      return null;\n    }\n    return target;\n  }\n\n  hook(): void {\n    if (!canvas.ready) return;\n    canvas.stage?.on(\"touchstart\", (evt) => {\n      this.touches++;\n      this.tapStart = Date.now();\n      this.tapStartPos = evt.client;\n      if (this.touches > 1) {\n        this.cancelled = true;\n      }\n    });\n\n    canvas.stage?.on(\"touchmove\", (evt) => {\n      if (evt.client.x != this.tapStartPos.x || evt.client.y != this.tapStartPos.y) {\n        this.cancelled = true;\n      }\n    });\n\n    canvas.stage?.on(\"touchend\", (evt) => {\n      if (this.touches > 0) this.touches--;\n      if (!this.cancelled && Date.now() - this.tapStart < this.tapMaxTime) {\n        const target = this.getTarget(evt);\n        if (!target) {\n          $(document.body).toggleClass(\"hide-hud\");\n        }\n      }\n      this.cancelled = false;\n    });\n\n    console.log(\"Mobile Improvements | Touch tap hooked\");\n  }\n}\n","import { preloadTemplates } from \"./module/preloadTemplates.js\";\r\nimport {\r\n  registerSettings,\r\n  settings,\r\n  getSetting,\r\n  setSetting,\r\n} from \"./module/settings.js\";\r\nimport * as windowMgr from \"./module/windowManager.js\";\r\nimport { MobileUI, ViewState } from \"./module/MobileUi.js\";\r\nimport { viewHeight } from \"./module/util.js\";\r\nimport { TouchInput } from \"./module/touchInput.js\";\r\n\r\ndeclare global {\r\n  interface LenientGlobalVariableTypes {\r\n    game: never;\r\n    ui: never;\r\n  }\r\n}\r\n\r\nfunction setMeta() {\r\n  const meta = document.querySelector(`meta[name=\"viewport\"]`);\r\n  if (meta) {\r\n    meta.setAttribute(\r\n      \"content\",\r\n      `width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0`\r\n    );\r\n  }\r\n}\r\n\r\nabstract class MobileMode {\r\n  static enabled = false;\r\n  static navigation: MobileUI;\r\n\r\n  static enter() {\r\n    if (MobileMode.enabled) return;\r\n    MobileMode.enabled = true;\r\n    document.body.classList.add(\"mobile-improvements\");\r\n    setMeta();\r\n    ui.nav?.collapse();\r\n    viewHeight();\r\n    Hooks.call(\"mobile-improvements:enter\");\r\n  }\r\n\r\n  static leave() {\r\n    if (!MobileMode.enabled) return;\r\n    MobileMode.enabled = false;\r\n    document.body.classList.remove(\"mobile-improvements\");\r\n    Hooks.call(\"mobile-improvements:leave\");\r\n  }\r\n\r\n  static viewResize() {\r\n    if (MobileMode.enabled) viewHeight();\r\n\r\n    if (game.settings && getSetting(settings.PIN_MOBILE_MODE))\r\n      return MobileMode.enter();\r\n    if (localStorage.getItem(\"mobile-improvements.pinMobileMode\") === \"true\")\r\n      return MobileMode.enter();\r\n\r\n    if (window.innerWidth <= 800) {\r\n      MobileMode.enter();\r\n    } else {\r\n      MobileMode.leave();\r\n    }\r\n  }\r\n}\r\n\r\ndocument.body.addEventListener(\"scroll\", () => {\r\n  document.body.scroll(0, 0);\r\n});\r\n\r\nfunction togglePlayerList(show: boolean) {\r\n  if (show) {\r\n    document.getElementById(\"players\")?.classList.add(\"mobile-hidden\");\r\n  } else {\r\n    document.getElementById(\"players\")?.classList.remove(\"mobile-hidden\");\r\n  }\r\n}\r\n\r\nfunction showToggleModeButton(show: boolean) {\r\n  if (!show) {\r\n    $(\"#mobile-improvements-toggle\").detach();\r\n    return;\r\n  }\r\n  const button = $(\r\n    `<a id=\"mobile-improvements-toggle\"><i class=\"fas fa-mobile-alt\"></i> ${game.i18n.localize(\r\n      \"MOBILEIMPROVEMENTS.EnableMobileMode\"\r\n    )}</a>`\r\n  );\r\n  $(\"body\").append(button);\r\n  button.on(\"click\", () => {\r\n    setSetting(settings.PIN_MOBILE_MODE, true);\r\n  });\r\n}\r\n\r\n// Trigger the recalculation of viewheight often. Not great performance,\r\n// but required to work on different mobile browsers\r\ndocument.addEventListener(\"fullscreenchange\", () =>\r\n  setTimeout(MobileMode.viewResize, 100)\r\n);\r\nwindow.addEventListener(\"resize\", MobileMode.viewResize);\r\nwindow.addEventListener(\"scroll\", MobileMode.viewResize);\r\nMobileMode.viewResize();\r\n\r\nHooks.once(\"init\", async function () {\r\n  console.log(\"Mobile Improvements | Initializing Mobile Improvements\");\r\n  windowMgr.activate();\r\n\r\n  if (MobileMode.navigation === undefined) {\r\n    MobileMode.navigation = new MobileUI();\r\n  }\r\n  registerSettings({\r\n    [settings.SHOW_PLAYER_LIST]: togglePlayerList,\r\n    [settings.SHOW_MOBILE_TOGGLE]: showToggleModeButton,\r\n    [settings.PIN_MOBILE_MODE]: (enabled) => {\r\n      if (enabled) MobileMode.enter();\r\n      else MobileMode.leave();\r\n    },\r\n  });\r\n  await preloadTemplates();\r\n});\r\n\r\nHooks.on(\"ready\", () => {\r\n  MobileMode.navigation.render(true);\r\n  showToggleModeButton(getSetting(settings.SHOW_MOBILE_TOGGLE));\r\n});\r\n\r\nHooks.once(\"renderChatLog\", (app: Application) => {\r\n  let touchWhenFocused = false;\r\n  const form = app.element.find(\"#chat-form\");\r\n  const textarea = form.find(\"#chat-message\").get(0);\r\n  const btn = $(\r\n    `<button id=\"chat-form--send\"><i class=\"fas fa-paper-plane\"></i></button>`\r\n  );\r\n\r\n  btn.on(\"touchstart\", () => {\r\n    if (document.activeElement === textarea) {\r\n      touchWhenFocused = true;\r\n    }\r\n  });\r\n  btn.on(\"touchend\", () => {\r\n    setTimeout(() => (touchWhenFocused = false), 100);\r\n  });\r\n\r\n  btn.on(\"click\", (evt) => {\r\n    evt.preventDefault();\r\n    if (touchWhenFocused) {\r\n      textarea?.focus();\r\n    }\r\n    //@ts-ignore\r\n    app._onChatKeyDown({\r\n      code: \"Enter\",\r\n      originalEvent: {},\r\n      preventDefault: () => {},\r\n      currentTarget: textarea,\r\n    });\r\n  });\r\n  form.append(btn);\r\n});\r\n\r\nHooks.once(\"renderSceneNavigation\", () => {\r\n  if (MobileMode.enabled) ui.nav?.collapse();\r\n});\r\n\r\nHooks.once(\"renderPlayerList\", () =>\r\n  togglePlayerList(getSetting(settings.SHOW_PLAYER_LIST))\r\n);\r\n\r\nHooks.on(\"createChatMessage\", (message: ChatMessage) => {\r\n  if (!MobileMode.enabled || !message.isAuthor) return;\r\n\r\n  const shouldBloop =\r\n    MobileMode.navigation.state === ViewState.Map ||\r\n    window.WindowManager.minimizeAll() ||\r\n    ui.sidebar.activeTab !== \"chat\";\r\n\r\n  MobileMode.navigation.showSidebar();\r\n  ui.sidebar.activateTab(\"chat\");\r\n\r\n  if (shouldBloop) {\r\n    Hooks.once(\"renderChatMessage\", (obj: ChatMessage, html: JQuery) => {\r\n      if (obj.id !== message.id) return; // Avoid possible race condition?\r\n\r\n      html.addClass(\"bloop\");\r\n      setTimeout(() => html.removeClass(\"bloop\"), 10000);\r\n    });\r\n  }\r\n});\r\n\r\nconst notificationQueueProxy = {\r\n  get: function (target, key) {\r\n    if (key === \"__isProxy\") return true;\r\n\r\n    if (key === \"push\") {\r\n      return (...arg) => {\r\n        if (Hooks.call(\"queuedNotification\", ...arg)) {\r\n          target.push(...arg);\r\n        }\r\n      };\r\n    }\r\n    return target[key];\r\n  },\r\n};\r\n\r\nHooks.once(\"renderNotifications\", (app) => {\r\n  if (!app.queue.__isProxy) {\r\n    app.queue = new Proxy(app.queue, notificationQueueProxy);\r\n  }\r\n});\r\n\r\nconst touchInput = new TouchInput();\r\nHooks.on(\"canvasReady\", () => touchInput.hook());\r\n\r\nHooks.on(\"queuedNotification\", (notif) => {\r\n  if (typeof notif.message === \"string\") {\r\n    const regex = /\\s.+px/g;\r\n    const message = notif.message?.replace(regex, \"\");\r\n    //@ts-ignore\r\n    const match = game.i18n.translations.ERROR.LowResolution.replace(regex, \"\");\r\n\r\n    if (message == match) {\r\n      console.log(\"notification suppressed\", notif);\r\n      return false;\r\n    }\r\n  }\r\n});\r\n\r\nglobalThis.MobileMode = MobileMode;\r\n"],"names":["windowMgr.activate"],"mappings":"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"}