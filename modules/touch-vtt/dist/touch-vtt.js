(()=>{var t={308:()=>{let t;!function(t){"use strict";let e=function(){function t(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),t.prototype.clearData=function(t){null!==t?delete this._data[t.toLowerCase()]:this._data={}},t.prototype.getData=function(t){let e=t.toLowerCase(),n=this._data[e];return"text"===e&&null==n&&(n=this._data["text/plain"]),n||""},t.prototype.setData=function(t,e){this._data[t.toLowerCase()]=e},t.prototype.setDragImage=function(t,e,i){let s=n._instance;s._imgCustom=t,s._imgOffset={x:e,y:i}},t}();t.DataTransfer=e;let n=function(){function t(){if(this._lastClick=0,t._instance)throw"DragDropTouch instance already created.";let e=!1;if(document.addEventListener("test",(function(){}),{get passive(){return e=!0,!0}}),navigator.maxTouchPoints){let t=document,n=this._touchstart.bind(this),i=this._touchmove.bind(this),s=this._touchend.bind(this),o=!!e&&{passive:!1,capture:!1};t.addEventListener("touchstart",n,o),t.addEventListener("touchmove",i,o),t.addEventListener("touchend",s),t.addEventListener("touchcancel",s)}}return t.getInstance=function(){return t._instance},t.prototype._touchstart=function(e){let n=this;if(this._shouldHandle(e)){this._reset();let i=this._closestDraggable(e.target);i&&(this._dispatchEvent(e,"mousemove",e.target)||this._dispatchEvent(e,"mousedown",e.target)||(this._dragSource=i,this._ptDown=this._getPoint(e),this._lastTouch=e,setTimeout((function(){n._dragSource===i&&null===n._img&&n._dispatchEvent(e,"contextmenu",i)&&n._reset()}),t._CTXMENU),t._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout((function(){n._isDragEnabled=!0,n._touchmove(e)}),t._PRESSHOLDAWAIT))))}},t.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t))this._reset();else if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){let e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img&&this._shouldStartDragging(t)){if(this._dispatchEvent(this._lastTouch,"dragstart",this._dragSource))return void(this._dragSource=null);this._createImage(t),this._dispatchEvent(t,"dragenter",e)}this._img&&(this._lastTouch=t,t.preventDefault(),this._dispatchEvent(t,"drag",this._dragSource),e!==this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",e))}},t.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target))return void t.preventDefault();this._img||(this._dragSource=null,this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},t.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},t.prototype._shouldHandleMove=function(e){return!t._ISPRESSHOLDMODE&&this._shouldHandle(e)},t.prototype._shouldHandlePressHoldMove=function(e){return t._ISPRESSHOLDMODE&&this._isDragEnabled&&e&&e.touches&&e.touches.length},t.prototype._shouldCancelPressHoldMove=function(e){return t._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(e)>t._PRESSHOLDMARGIN},t.prototype._shouldStartDragging=function(e){let n=this._getDelta(e);return n>t._THRESHOLD||t._ISPRESSHOLDMODE&&n>=t._PRESSHOLDTHRESHOLD},t.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new e,clearInterval(this._pressHoldInterval)},t.prototype._getPoint=function(t,e){return t&&t.touches&&(t=t.touches[0]),{x:e?t.pageX:t.clientX,y:e?t.pageY:t.clientY}},t.prototype._getDelta=function(e){if(t._ISPRESSHOLDMODE&&!this._ptDown)return 0;let n=this._getPoint(e);return Math.abs(n.x-this._ptDown.x)+Math.abs(n.y-this._ptDown.y)},t.prototype._getTarget=function(t){let e=this._getPoint(t),n=document.elementFromPoint(e.x,e.y);for(;n&&"none"==getComputedStyle(n).pointerEvents;)n=n.parentElement;return n},t.prototype._createImage=function(e){this._img&&this._destroyImage();let n=this._imgCustom||this._dragSource;if(this._img=n.cloneNode(!0),this._copyStyle(n,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){let i=n.getBoundingClientRect(),s=this._getPoint(e);this._imgOffset={x:s.x-i.left,y:s.y-i.top},this._img.style.opacity=t._OPACITY.toString()}this._moveImage(e),document.body.appendChild(this._img)},t.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},t.prototype._moveImage=function(t){let e=this;requestAnimationFrame((function(){if(e._img){let n=e._getPoint(t,!0),i=e._img.style;i.position="absolute",i.pointerEvents="none",i.zIndex="999999",i.left=Math.round(n.x-e._imgOffset.x)+"px",i.top=Math.round(n.y-e._imgOffset.y)+"px"}}))},t.prototype._copyProps=function(t,e,n){for(let i=0;i<n.length;i++){let s=n[i];t[s]=e[s]}},t.prototype._copyStyle=function(e,n){if(t._rmvAtts.forEach((function(t){n.removeAttribute(t)})),e instanceof HTMLCanvasElement){let t=e,i=n;i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)}let i=getComputedStyle(e);for(let t=0;t<i.length;t++){let e=i[t];e.indexOf("transition")<0&&(n.style[e]=i[e])}n.style.pointerEvents="none";for(let t=0;t<e.children.length;t++)this._copyStyle(e.children[t],n.children[t])},t.prototype._setOffsetAndLayerProps=function(t,e){let n;void 0===t.offsetX&&(n=e.getBoundingClientRect(),t.offsetX=t.clientX-n.x,t.offsetY=t.clientY-n.y),void 0===t.layerX&&(n=n||e.getBoundingClientRect(),t.layerX=t.pageX-n.left,t.layerY=t.pageY-n.top)},t.prototype._dispatchEvent=function(e,n,i){if(e&&i){let s=new Event(n,{bubbles:!0,cancelable:!0}),o=e.touches?e.touches[0]:e;return s.button=0,s.which=s.buttons=1,this._copyProps(s,e,t._kbdProps),this._copyProps(s,o,t._ptProps),this._setOffsetAndLayerProps(s,i),s.dataTransfer=this._dataTransfer,i.dispatchEvent(s),s.defaultPrevented}return!1},t.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.draggable)return t;return null},t}();n._instance=new n,n._THRESHOLD=5,n._OPACITY=.5,n._DBLCLICK=500,n._CTXMENU=900,n._ISPRESSHOLDMODE=!1,n._PRESSHOLDAWAIT=400,n._PRESSHOLDMARGIN=25,n._PRESSHOLDTHRESHOLD=0,n._rmvAtts="id,class,style,draggable".split(","),n._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),n._ptProps="pageX,pageY,clientX,clientY,screenX,screenY,offsetX,offsetY".split(","),t.DragDropTouch=n}(t||(t={}))}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}(()=>{"use strict";const t="TouchVTT",e="touch-vtt";let i;Hooks.once("init",(()=>{i=!globalThis.libWrapper||(globalThis.libWrapper.is_fallback??1)?class{static get is_fallback(){return!0}static register(t,e,n,i="MIXED"){const s=e.endsWith("#set"),o=(e=s?e.slice(0,-4):e).split("."),r=o.pop(),a=o.splice(0,1)[0],c=eval,l=o.reduce(((t,e)=>t[e]),globalThis[a]||c(a));let h=null;const u="OVERRIDE"===i?function(){return n.call(this,...arguments)}:function(){return n.call(this,h.bind(this),...arguments)},d=Object.getOwnPropertyDescriptor(l,r);if(null!=d){if(d.value)return h=l[r],void(l[r]=u);s?(h=d.set,d.set=u):(h=d.get,d.get=u),d.configurable=!0,Object.defineProperty(l,r,d)}else{if("function"!=typeof l[r])throw`libWrapper Shim: "${e}" does not exist or could not be found.`;h=l[r],l[r]=u}}}:globalThis.libWrapper}));const s="touch-vtt";function o(t,e,n="WRAPPER"){return i.register(s,t,e,n)}function r(t,e){return i.register(s,t,((t,...n)=>{if(e(...n))return t(...n)}),"MIXED")}function a(t,e=t.type,{button:n=t.button,buttons:i=t.buttons}={},s=0){const o={clientX:t.clientX+s,clientY:t.clientY+s,screenX:t.screenX+s,screenY:t.screenY+s,ctrlKey:t.ctrlKey||!1,altKey:t.altKey||!1,shiftKey:t.shiftKey||!1,metaKey:t.metaKey||!1,button:n,buttons:i,relatedTarget:t.relatedTarget||null,region:t.region||null,detail:0,view:window,sourceCapabilities:t.sourceCapabilities,bubbles:!0,cancelable:!0,composed:!0},r={pointerId:t.pointerId,pointerType:"mouse",isPrimary:!0,...o};var a=t.nativeEvent?t.nativeEvent.target:t.target;const c=new PointerEvent(e,r);a.dispatchEvent(c)}const c=new class{get zero(){return{x:0,y:0}}add(t,e){return{x:t.x+e.x,y:t.y+e.y}}subtract(t,e){return{x:t.x-e.x,y:t.y-e.y}}divideElements(t,e){return{x:t.x/e.x,y:t.y/e.y}}divideScalar(t,e){return{x:t.x/e,y:t.y/e}}distance(t,e){const n=this.subtract(t,e);return this.length(n)}distanceSquared(t,e){const n=this.subtract(t,e);return this.lengthSquared(n)}centerBetween(t,e){const n=this.subtract(t,e);return this.add(t,this.divideScalar(n,2))}centerOf(t,e,n){const i=[t,e,n],s=[this.distanceSquared(t,e)+this.distanceSquared(t,n),this.distanceSquared(e,t)+this.distanceSquared(e,n),this.distanceSquared(n,t)+this.distanceSquared(n,e)].reduce(((t,e,n)=>e<t.distance?{index:n,distance:e}:t),{distance:Number.MAX_VALUE,index:-1}).index,o=i.map(((t,e)=>e));o.splice(s,1);let r=i[s];for(const t of o){const e=this.subtract(i[s],i[t]);r=this.add(r,this.divideScalar(e,2))}return r}length(t){return Math.sqrt(t.x**2+t.y**2)}lengthSquared(t){return t.x**2+t.y**2}abs(t){return{x:Math.abs(t.x),y:Math.abs(t.y)}}isEqual(t,e){return t.x===e.x&&t.y===e.y}},l=function t(e){if((e=e&&e instanceof Object?e:"")instanceof Date)return new Date(e);if(e instanceof Array)return e.slice();if(e instanceof Object){const n=Object.create(e.constructor.prototype);for(const i in e)e.hasOwnProperty(i)&&(e[i]instanceof Object?n[i]=t(e[i]):n[i]=e[i]);return n}throw new Error("Unable to copy obj! Its type isn't supported.")},h=new class{get isGm(){return this.raw.isGM}get raw(){return game.user}},u=new class{isActive(t){const e=game.modules.get(t);return null!=e&&e.active}},d="LockView",g=new class{get raw(){return canvas}get zoom(){return this.raw.stage.scale.x}pan({x:t,y:e,zoom:n}){this.raw.pan({x:t,y:e,scale:n})}zoom(t){this.raw.pan({scale:t})}get worldTransform(){return this.raw.stage.transform.worldTransform}screenToWorld({x:t,y:e}){return this.worldTransform.applyInverse({x:t,y:e})}worldToScreen({x:t,y:e}){return this.worldTransform.apply({x:t,y:e})}worldToScreenLength(t){return this.worldTransform.apply({x:t,y:0}).x-this.worldTransform.apply({x:0,y:0}).x}getWorldTransformWith({zoom:t},{discrete:e=!0}={}){const n=l(this.worldTransform);return e&&(t=Math.round(100*t)/100),n.a=n.d=t,n}get gridSize(){return this.raw.grid.size}toRelativeCoordinates({x:t,y:e}){const n=this.worldSize;return{x:t/n.x,y:e/n.y}}get worldSize(){return{x:this.raw.scene.data.width,y:this.raw.scene.data.height}}get worldCenter(){const t=this.worldSize;return{x:t.x/2,y:t.y/2}}isZoomAllowed(){return!!h.isGm||!u.isActive(d)||!this.raw.scene.getFlag(d,"lockZoom")}isPanAllowed(){return!!h.isGm||!u.isActive(d)||!this.raw.scene.getFlag(d,"lockPan")}get ruler(){const t=canvas&&canvas.controls;return t&&t.ruler}},p=new class{get center(){return{x:window.innerWidth/2,y:window.innerHeight/2}}get size(){return{x:window.innerWidth,y:window.innerHeight}}toRelativeCoordinates({x:t,y:e}){const n=this.size;return{x:t/n.x,y:e/n.y}}},f=`${e}-bug_button_styles`,m="\n#controls ol.control-tools > li.scene-control, #controls ol.control-tools > li.control-tool {\n    width: 50px;\n    height: 50px;\n    line-height: 50px;\n    font-size: 28px;\n}\n#controls ol.control-tools {\n    left: 72px;\n}\n";function v(t){const e=document.getElementById(f);null!=e&&(e.innerHTML=t?m:"")}const y="core",b="gestureMode",_="off",E="combined",T="split",w="directionalArrows",D="on",S="largeButtons",O="easyTarget",M="off",P="single",C="multiple",L="measurementHud",k="off",R="right",I="left",x="zoomSensitivity",A="debugMode";function H(t){let n;try{n=game.settings.get(e,t+"_override")}catch(t){n="override_off"}return"override_off"==n?game.settings.get(e,t):("Boolean"==game.settings.settings.get(e+"."+t).type.name&&(n="on"==n),n)}class N extends FormApplication{constructor(t){super(),this.exampleOption=t}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["form"],popOut:!0,template:`/modules/${e}/templates/settings-override.hbs`,id:`${e}-settings-override-form`,title:`${t} - Settings Override`})}getData(){var t=[...game.settings.settings].filter((t=>t[0].startsWith(e)&&t[0].endsWith("_override")));return{settings:Object.fromEntries([...t].map((t=>{t[0]=t[0].split(".")[1];var n=game.settings.get(e,t[0]);t[1].currentValue=n;for(let e in t[1].choices)"string"==typeof t[1].choices[e]&&(t[1].choices[e]={label:t[1].choices[e]}),t[1].choices[e].selected=e==n;return t})))}}async _updateObject(t,n){const i=expandObject(n);for(let t in i)game.settings.set(e,t,i[t]);this.reloadConfirm()}async reloadConfirm(){await Dialog.confirm({title:game.i18n.localize("SETTINGS.ReloadPromptTitle"),content:`<p>${game.i18n.localize("SETTINGS.ReloadPromptBody")}</p>`})&&(game.user.isGM&&game.socket.emit("reload"),foundry.utils.debouncedReload())}activateListeners(t){super.activateListeners(t)}}const U=Object.freeze({left:0,right:2});class G{constructor({name:t,forwardingEvents:e=[],mouseButton:n=null,isFinal:i=!0}={}){this.name=t,this.forwardingEvents=e,this.mouseButton=n,this.isFinal=i}forwardsEvent(t){let e=t;return"object"==typeof t&&"string"==typeof t.type&&(e=t.type),-1!==this.forwardingEvents.indexOf(e)}}const z=["pointerdown","pointermove","pointerup","pointercancel","touchstart","touchmove","touchend","touchcancel"],j=Object.freeze(new G({name:"primary-click",forwardingEvents:z,mouseButton:U.left,isFinal:!1})),F=Object.freeze(new G({name:"secondary-click",forwardingEvents:z,mouseButton:U.right})),X=Object.freeze(new G({name:"zoom-pan"})),W=Object.freeze({PRIMARY_CLICK:j,SECONDARY_CLICK:F,ZOOM_PAN_GESTURE:X});class K{constructor(t){this.touches={};const e=this.handleTouch.bind(this);for(const n of this.getListenerEvents())t instanceof HTMLElement?t.addEventListener(n,e,this.getEventListenerOptions()):document.addEventListener(n,(n=>{n.target.closest(t)&&e(n)}),this.getEventListenerOptions());this._gesturesEnabled=!0}preHandle(t){}handleTouch(t){if(this.isTouchPointerEvent(t)&&(this.preHandle(t),this.shouldHandleEvent(t)))switch(t.type){case"pointerdown":this.handleTouchStart(t);break;case"pointermove":this.handleTouchMove(t);break;case"pointerup":this.handleTouchEnd(t);break;case"pointercancel":this.handleEndAll(t);break;default:console.warn(`Unknown touch event type ${t.type}`)}}handleTouchStart(t){this.updateActiveTouch(t),this.touchIds.length>1&&a(t,"pointerup")}handleTouchEnd(t){this.cleanUpTouch(t)}handleEndAll(t){this.cleanUpAll()}handleTouchMove(t){this.updateActiveTouch(t)}updateActiveTouch(t){var e=t.pointerId;null!=this.touches[e]?this.touches[e].update(t,t):this.touches[e]=new class{constructor(t,e,{context:n=W.PRIMARY_CLICK}={}){this.id=function(t){return null!=t.pointerId?t.pointerId:null!=t.touches&&t.touches.length>0?t.touches[0].identifier:null}(t),this.start=Object.freeze({x:e.clientX,y:e.clientY}),this.last=this.start,this.current=this.last,this.context=n,this.clientX=e.clientX,this.clientY=e.clientY,this.screenX=e.screenX,this.screenY=e.screenY,this.target=t.target,this.latestEvent=t,this.world=g.screenToWorld(this.current),this.movementDistance=0,this.movement=c.zero}get identifier(){return this.id}update(t,e){this.latestEvent=t,this.last=this.current,this.current=Object.freeze({x:e.clientX,y:e.clientY}),this.movementDistance+=c.distance(this.last,this.current),this.movement=c.add(this.movement,c.subtract(this.current,this.last))}}(t,t)}cleanUpAll(){this.touches={}}cleanUpTouch(t){delete this.touches[t.pointerId]}getEventListenerOptions(){return{capture:!0,passive:!1}}getListenerEvents(){return["pointerdown","pointermove","pointerup","pointercancel"]}shouldHandleEvent(t){return t.isTrusted}isTouchPointerEvent(t){return t instanceof PointerEvent&&["touch","pen"].includes(t.pointerType)}get touchIds(){return Object.keys(this.touches)}disableGestures(){this._gesturesEnabled=!1}enableGestures(){this._gesturesEnabled=!0}gesturesEnabled(){return this._gesturesEnabled}}K.init=function(t){return new K(t)};const Y=K;class V extends Y{constructor(t){super(t)}preHandle(t){game.release.generation<12&&"pointerdown"==t.type&&t.isTrusted&&a(t,"pointermove",{button:-1,buttons:0})}handleTouchMove(t){switch(this.updateActiveTouch(t),this.touchIds.length){case 2:this.gesturesEnabled()&&(this.useSplitGestures()?this.handleTwoFingerZoom(t):this.handleTwoFingerZoomAndPan(t));break;case 3:case 4:this.gesturesEnabled()&&this.handleMultiFingerPan(t)}}handleTwoFingerZoomAndPan(){this.handleTwoFingerZoom(),this.handleMultiFingerPan()}handleTwoFingerZoom(){if(!g.isZoomAllowed())return;const t=this.touchIds,e=this.touches[t[0]],n=this.touches[t[1]];g.zoom(this.calcZoom(e,n))}handleMultiFingerPan(){if(!g.isPanAllowed())return;const t=this.touchIds,e=g.worldTransform;let n=this.calcPanCorrection(e,this.touches[t[0]]);const i=g.screenToWorld(p.center),s=c.subtract(i,n);g.pan({x:s.x,y:s.y})}easeFactorBasedOnDistance(t,e){return 2/(1+Math.E**(-t/e))-1}calcZoom(t,e){const n=H(x),i=c.distance(t.last,e.last),s=c.distance(t.current,e.current),o=(s-i)/i;return canvas.stage.scale.x*(1+o*n*this.easeFactorBasedOnDistance(s,100))}calcPanCorrection(t,e){const n=t.applyInverse(e.current);return c.subtract(n,e.world)}useSplitGestures(){return H(b)===T}useNoGestures(){return H(b)===_}gesturesEnabled(){return this._gesturesEnabled&&!this.useNoGestures()}}V.init=function(t){return new V(t)};const B=V;class Z extends Y{constructor(t){super(t),this.selector=t,this.scrollStart=null}contextMenuCanceler(t){t.preventDefault(),t.stopPropagation()}handleTouchMove(t){switch(this.updateActiveTouch(t),this.touchIds.length){case 2:case 3:case 4:this.gesturesEnabled()&&this.handleMultiFingerScroll(t)}}handleTouchEnd(t){this.cleanUpTouch(t),this.scrollStart=null,document.removeEventListener("contextmenu",this.contextMenuCanceler,!0)}handleMultiFingerScroll(){document.addEventListener("contextmenu",this.contextMenuCanceler,!0);const t=this.touchIds,e=this.touches[t[0]],n=this.findFirstScrollableParent(e.target);this.scrollStart||(this.scrollStart=n.scrollTop),n.scrollTop=this.scrollStart+e.start.y-e.current.y}findFirstScrollableParent(t){let e=null;for(;!e&&t?.closest(this.selector);)t.scrollHeight>t.clientHeight&&(e=t),t=t.parentElement;return e}}Z.init=function(t){return new Z(t)};const q=Z;n(308);const J=`${e}-draggable_apps_styles`;class Q{constructor(){this.lastClickInfo={target:null,time:0,touch:!1},this.touchManager=q.init(".app, .application"),document.body.addEventListener("dblclick",(t=>{const e=!!t.target.closest(".app, .application");if(t.isTrusted&&e&&this.lastClickInfo.touch)return t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),!1}),!0),$(document.body).on("click",".app, .application",this.manageTouchDblClick.bind(this)),o("DragDrop.prototype._handleDragStart",(function(t,e){if(e.dataTransfer.items)return t.call(this,e);this.callback(e,"dragstart"),Object.keys(e.dataTransfer._data).length&&e.stopPropagation()}),"MIXED")}manageTouchDblClick(t){const e=["touch","pen"].includes(t.pointerType);e&&Date.now()-this.lastClickInfo.time<500&&t.target==this.lastClickInfo.target&&(a(t,"dblclick"),this.lastClickInfo={target:null,time:0,touch:e}),this.lastClickInfo={target:t.target,time:Date.now(),touch:e}}fixDirectoryScrolling(t,e){const n=t.element.find(".directory-list");n.length>0&&(e?n.find('li[draggable="true"].directory-item').each((function(t,e){e.draggable=!1;let n=document.createElement("i");n.className="handlebar fas fa-grip-vertical",n.addEventListener("pointerdown",(t=>{e.draggable=!0}),!0),n.addEventListener("pointerup",(t=>{["touch","pen"].includes(t.pointerType)&&(e.draggable=!1)}),!0),e.classList.contains("folder")?e.getElementsByTagName("header")[0].prepend(n):e.prepend(n)})):(n.find(".directory-item .handlebar").remove(),n.find('li[draggable="false"].directory-item').each((function(t,e){e.draggable=!0}))))}}Q.init=function(){return function(){const t=document.createElement("style");t.setAttribute("id",J),t.innerHTML="\n.app, .application {\n  touch-action: none;\n}\n\n.app .window-header, .application .window-header, .app .window-title, .application .window-title {\n  touch-action: none;\n}\n\n.directory-item .handlebar {\n  display: none;\n  flex: 0 0 20px;\n  align-self: center;\n  font-size: 1.6em;\n  z-index: 10;\n}\n\n.directory-item.document .handlebar {\n  height: var(--sidebar-item-height);\n  padding: 14px 0 0 4px;\n}\n\n.directory-item.folder .handlebar {\n  line-height: 24px;\n  margin: 0 4px 0 0;\n}\n\n.directory-item.compendium .handlebar {\n  position: absolute;\n  left: 6px;\n}\n\nbody.touchvtt-using-touch .directory-item.compendium {\n  flex-direction: row;\n}\n\nbody.touchvtt-using-touch .directory-item.compendium .compendium-banner {\n  pointer-events: none;\n}\n\nbody.touchvtt-using-touch .directory-item .handlebar {\n  display: flex;\n}\n",document.head.append(t)}(),new Q};const tt=Q,et="erase";class nt extends Application{constructor({touchPointerEventsManager:t,templateManager:e}){super(),this._touchPointerEventsManager=t,this._templateManager=e,this._worldPosition=null,this._screenPosition={},this._currentTemplate=null}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"touch-measured-template-hud",template:`/modules/${e}/templates/measured-template-hud.hbs`,popOut:!1,width:200,height:100,left:150,top:80,scale:1,minimizable:!1,resizable:!1,dragDrop:[],tabs:[],scrollY:[]})}getData(...t){const e=super.getData(...t);return e.id=this.options.id,e.top=this._screenPosition.top,e.left=this._screenPosition.left,e.offsetX=this.calcOffsetX(),e.showRotate=!0,e.showConfirm=!0,e}activateListeners(t){t.find(".rotate").on("pointerdown",(()=>{this._currentTemplate.document.updateSource({direction:this._currentTemplate.document.direction+15}),this._currentTemplate.refresh()})),t.find(".confirm").on("pointerdown",(()=>{this._templateManager.toggleMeasuredTemplateTouchManagementListeners(!1),this._templateManager._touchMode=!1,document.getElementById("board").dispatchEvent(new PointerEvent("pointerdown",{pointerType:"mouse",isPrimary:!0,clientX:this._screenPosition.left,clientY:this._screenPosition.top,button:0,buttons:1})),document.getElementById("board").dispatchEvent(new PointerEvent("pointerup",{pointerType:"mouse",isPrimary:!0,clientX:this._screenPosition.left,clientY:this._screenPosition.top,button:0,buttons:1})),canvas.hud.touchMeasuredTemplate.clear()}))}async show(t){this._currentTemplate=t;const e={x:t.document.x,y:t.document.y};if(this._templateManager._touchMode){this._worldPosition=e;const t=g.worldToScreen(e);this.setScreenPosition({left:t.x,top:t.y});const n=this.constructor.RENDER_STATES;await this.render(this._state<=n.NONE),this._touchPointerEventsManager.disableGestures()}}clear(){const t=this.constructor.RENDER_STATES;this._state<=t.NONE||(this._state=t.CLOSING,this.element.hide(),this._state=t.NONE,this._touchPointerEventsManager.enableGestures())}setScreenPosition({top:t,left:e}){this._screenPosition={top:t,left:e}}calcOffsetX(){const t=.75*g.worldToScreenLength(g.gridSize);return H(L)===I?`calc(-100% - ${t}px)`:`${t}px`}}class it{constructor(){this._touchMode=!1,this._touchEventReplacer=this.touchEventReplacer.bind(this)}initMeasuredTemplateHud(t){null==canvas.hud.touchMeasuredTemplate&&(canvas.hud.touchMeasuredTemplate=new nt({touchPointerEventsManager:t,templateManager:this}),o("MeasuredTemplate.prototype._applyRenderFlags",(function(t,e){return e.refreshPosition&&canvas.hud.touchMeasuredTemplate.show(this),t.call(this,e)})))}touchEventReplacer(t){if(t.isTrusted){if(!(t instanceof TouchEvent||t instanceof PointerEvent&&["touch","pen"].includes(t.pointerType)))return this._touchMode=!1,this.toggleMeasuredTemplateTouchManagementListeners(!1);this._touchMode=!0}return!this._touchMode||!t.isTrusted||"CANVAS"!=t.target.tagName||(t.preventDefault(),t.stopPropagation(),t instanceof PointerEvent&&a(t,"pointermove",{button:-1,buttons:0}),!1)}toggleMeasuredTemplateTouchManagementListeners(t=!0){["pointerdown","pointerup","pointermove","pointercancel","touchstart","touchmove","touchend"].forEach(t?t=>{window.addEventListener(t,this._touchEventReplacer,!0)}:t=>{window.removeEventListener(t,this._touchEventReplacer,!0)})}initMeasuredTemplateManagement(){const t=()=>game.activeTool===et,e=()=>!t()&&!this._touchMode;r("TemplateLayer.prototype._onDragLeftStart",e),r("TemplateLayer.prototype._onDragLeftMove",e),r("TemplateLayer.prototype._onDragLeftDrop",e),r("TemplateLayer.prototype._onDragLeftCancel",e),o("MeasuredTemplate.prototype._onClickLeft",(function(e,...n){t()?(this.document.delete(),game.release.generation<12&&setTimeout((()=>{document.getElementById("board").dispatchEvent(new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window,button:2}))}),0)):e(...n)}),"MIXED"),Hooks.on("drawMeasuredTemplate",(t=>{this.isPremade(t)&&this.toggleMeasuredTemplateTouchManagementListeners(!0)}))}isPremade(t){const e=game.release.generation<12?canvas.grid.grid.options.dimensions.distance:canvas.grid.distance;return!t.id&&t.document.distance>e}}it.init=function(){return new it};let st=!1;let ot=!0;function rt(){return H(O)}function at(t,e){const n=game.i18n.localize(`TOUCHVTT.Rotate${e}`),i=$(`<div class="control-icon directional-arrow directional-arrow-${e}" data-action="rotate-${e}" title="${n}">\n      <i class="fas fa-chevron-up"></i>\n    </div>`);i.on("click",(()=>{const t=ct();var n;null!=(n=t)&&"function"==typeof n._canDrag&&n._canDrag()&&t.rotate((e+180)%360)})),t.prepend(i)}function ct(){return canvas&&canvas.hud&&canvas.hud.token&&canvas.hud.token.object}class lt extends Application{constructor({touchPointerEventsManager:t}){super(),this._touchPointerEventsManager=t,this._worldPosition=null,this._screenPosition={}}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"touch-measurement-hud",template:`/modules/${e}/templates/measurement-hud.hbs`,popOut:!1,width:200,height:100,left:150,top:80,scale:1,minimizable:!1,resizable:!1,dragDrop:[],tabs:[],scrollY:[]})}getData(...t){const e=super.getData(...t);return e.id=this.options.id,e.top=this._screenPosition.top,e.left=this._screenPosition.left,e.offsetX=this.calcOffsetX(),e.showRuler=!c.isEqual(this._worldPosition??{},this.lastWaypoint),e.showMove=this.canMoveToken(),e}activateListeners(t){t.find(".waypoint").on("pointerdown",(()=>{const t=g.ruler;null!=t&&"function"==typeof t._addWaypoint&&(t._addWaypoint(this._worldPosition),this.render())})),t.find(".move").on("pointerdown",(()=>{const t=g.ruler;null!=t&&"function"==typeof t.moveToken&&((t.token||t._getMovementToken()).document.locked=!1,t.moveToken(),this.render())}))}async show(t){this._worldPosition=t;const e=g.worldToScreen(t);this.setScreenPosition({left:e.x,top:e.y});const n=this.constructor.RENDER_STATES;await this.render(this._state<=n.NONE),this._touchPointerEventsManager.disableGestures()}clear(){const t=this.constructor.RENDER_STATES;this._state<=t.NONE||(this._state=t.CLOSING,this.element.hide(),this._state=t.NONE,this._touchPointerEventsManager.enableGestures())}setScreenPosition({top:t,left:e}){this._screenPosition={top:t,left:e}}get lastWaypoint(){const t=g.ruler;return(t&&t.waypoints[t.waypoints.length-1])??{}}canMoveToken(){const t=g.ruler;return!(null==t||(game.paused&&!game.user.isGM?(ui.notifications.warn("GAME.PausedWarning",{localize:!0}),1):!t.visible||!t.destination||null==t._getMovementToken(t.origin)))}calcOffsetX(){const t=.75*g.worldToScreenLength(g.gridSize);return ut()===I?`calc(-100% - ${t}px)`:`${t}px`}}function ht(t){return g.ruler===t}function ut(){return H(L)}class dt{constructor(t,e,n={},i={},s={}){this.object=t,this.layer=e,this.permissions=n,this.callbacks=i,this.options=s,this.state=this.states.NONE,this.interactionData={},this.dragTime=0,this.lcTime=0,this.rcTime=0,this._dragRight=!1,this.controlIcon=this.options.target?this.object[this.options.target]:void 0;const o=this.options.application??canvas.app;this.viewId=o.view.id}#t={};static INTERACTION_STATES={NONE:0,HOVER:1,CLICKED:2,DRAG:3,DROP:4};static _HANDLER_OUTCOME={SKIPPED:-2,DISALLOWED:-1,REFUSED:1,ACCEPTED:2};static LONG_PRESS_DURATION_MS=500;static longPressTimeout=null;get target(){return this.options.target?this.object[this.options.target]:this.object}get isDragging(){return this.state>=this.states.DRAG}activate(){return this.state=this.states.NONE,this.target.removeAllListeners(),this.#t={mouseover:this.#e.bind(this),mouseout:this.#n.bind(this),mousedown:this.#i.bind(this),rightdown:this.#s.bind(this),mousemove:this.#o.bind(this),mouseup:this.#r.bind(this),contextmenu:this.#a.bind(this)},this.#c(),this.target.eventMode="static",this}can(t,e){const n=this.permissions[t];return"boolean"==typeof n?n:!(n instanceof Function)||n.call(this.object,game.user,e)}callback(t,e,...n){const i=this.callbacks[t];return!(i instanceof Function)||(this.#l(e),i.call(this.object,e,...n)??!0)}get states(){return this.constructor.INTERACTION_STATES}get handlerOutcomes(){return this.constructor._HANDLER_OUTCOME}#c(){this.target.off("pointerover",this.#t.mouseover).on("pointerover",this.#t.mouseover),this.target.off("pointerout",this.#t.mouseout).on("pointerout",this.#t.mouseout)}#h(){this.#u(),this.target.on("pointerdown",this.#t.mousedown),this.target.on("pointerup",this.#t.mouseup),this.target.on("pointerupoutside",this.#t.mouseup),this.target.on("rightdown",this.#t.rightdown),this.target.on("rightup",this.#t.mouseup),this.target.on("rightupoutside",this.#t.mouseup)}#u(){this.target.off("pointerdown",this.#t.mousedown),this.target.off("pointerup",this.#t.mouseup),this.target.off("pointerupoutside",this.#t.mouseup),this.target.off("rightdown",this.#t.rightdown),this.target.off("rightup",this.#t.mouseup),this.target.off("rightupoutside",this.#t.mouseup)}#d(){this.#g(),this.layer.on("pointermove",this.#t.mousemove),this._dragRight||canvas.app.view.addEventListener("contextmenu",this.#t.contextmenu,{capture:!0})}#g(t){this.layer.off("pointermove",this.#t.mousemove),canvas.app.view.removeEventListener("contextmenu",this.#t.contextmenu,{capture:!0})}#e(t){const e="hoverIn";return this.state!==this.states.NONE||t.nativeEvent.target.id!==this.viewId?this.#p(e,t,this.handlerOutcomes.SKIPPED):this.can(e,t)?this.callback(e,t)?(this.state=Math.max(this.state||0,this.states.HOVER),this.#h(),this.#p(e,t)):this.#p(e,t,this.handlerOutcomes.REFUSED):this.#p(e,t,this.handlerOutcomes.DISALLOWED)}#n(t){if("touch"===t.pointerType)return;const e="hoverOut";return this.state!==this.states.HOVER||t.nativeEvent.target.id!==this.viewId?this.#p(e,t,this.handlerOutcomes.SKIPPED):this.can(e,t)?!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):(this.state===this.states.HOVER&&(this.state=this.states.NONE,this.#u()),this.#p(e,t)):this.#p(e,t,this.handlerOutcomes.DISALLOWED)}#i(t){if(0!==t.button)return;if(![this.states.HOVER,this.states.CLICKED,this.states.DRAG].includes(this.state))return;const e=Date.now(),n=e-this.lcTime<=250;return this.lcTime=e,this.interactionData.origin=t.getLocalPosition(this.layer),n||(clearTimeout(this.constructor.longPressTimeout),this.constructor.longPressTimeout=setTimeout((()=>{this.#f(t,this.interactionData.origin)}),MouseInteractionManager.LONG_PRESS_DURATION_MS)),n&&this.can("clickLeft2",t)?this.#m(t):this.#v(t)}#v(t){const e="clickLeft";return this.can(e,t)?(this._dragRight=!1,!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):(this.state===this.states.HOVER&&(this.state=this.states.CLICKED),canvas.currentMouseManager=this,this.state<this.states.DRAG&&this.can("dragStart",t)&&this.#d(),this.#p(e,t))):this.#p(e,t,this.handlerOutcomes.DISALLOWED)}#m(t){const e="clickLeft2";return!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):this.#p(e,t)}#f(t,e){const n="longPress";return!1===this.callback(n,t,e)?this.#p(n,t,this.handlerOutcomes.REFUSED):this.#p(n,t)}#s(t){if(![this.states.HOVER,this.states.CLICKED,this.states.DRAG].includes(this.state))return;if(2!==t.button)return;const e=Date.now(),n=e-this.rcTime<=250;return this.rcTime=e,this.interactionData.origin=t.getLocalPosition(this.layer),n&&this.can("clickRight2",t)?this.#y(t):this.#b(t)}#b(t){const e="clickRight";return this.can(e,t)?(this._dragRight=!0,!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):(this.state===this.states.HOVER&&(this.state=this.states.CLICKED),canvas.currentMouseManager=this,this.state<this.states.DRAG&&this.can("dragRight",t)&&this.#d(),this.#p(e,t))):this.#p(e,t,this.handlerOutcomes.DISALLOWED)}#y(t){const e="clickRight2";return!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):this.#p(e,t)}#o(t){if(![this.states.CLICKED,this.states.DRAG].includes(this.state))return;const e=Date.now();if(e-this.dragTime<canvas.app.ticker.elapsedMS)return;this.dragTime=e;const n=this.interactionData;if(n.destination=t.getLocalPosition(this.layer),void 0===n.origin&&(n.origin=(new PIXI.Point).copyFrom(n.destination)),this.state!==this.states.CLICKED)return this.#_(t);{const e=n.destination.x-n.origin.x,i=n.destination.y-n.origin.y;if(Math.hypot(e,i)>=(this.options.dragResistance||canvas.dimensions.size/4))return this.#E(t)}}#E(t){clearTimeout(this.constructor.longPressTimeout);const e=this._dragRight?"dragRightStart":"dragLeftStart";if(!this.can(e,t))return this.#p(e,t,this.handlerOutcomes.DISALLOWED);const n=this.callback(e,t);return n&&(this.state=this.states.DRAG),this.#p(e,t,n?this.handlerOutcomes.ACCEPTED:this.handlerOutcomes.REFUSED)}#_(t){clearTimeout(this.constructor.longPressTimeout);const e=this._dragRight?"dragRightMove":"dragLeftMove";if(!this.can(e,t))return this.#p(e,t,this.handlerOutcomes.DISALLOWED);const n=this.callback(e,t);return n&&(this.state=this.states.DRAG),this.#p(e,t,n?this.handlerOutcomes.ACCEPTED:this.handlerOutcomes.REFUSED)}#r(t){clearTimeout(this.constructor.longPressTimeout),this.state===this.states.HOVER&&"touch"===t.pointerType&&(this.state=this.states.DRAG);const e=this.state;if(this.interactionData.destination=t.getLocalPosition(this.layer),this.state===this.states.CLICKED&&!t.defaultPrevented&&t.target!==this.object&&t.target?.parent!==this.object&&(t.stopPropagation(),this.state=this.states.HOVER,this.#u(),this.#n(t)),this.state>=this.states.DRAG){if(t.stopPropagation(),t.type.startsWith("right")&&!this._dragRight)return;this.#T(t)}return t.defaultPrevented?(this.state=e,this.#p("mouseUp",t,this.handlerOutcomes.SKIPPED)):this.#a(t)}#T(t){const e=this._dragRight?"dragRightDrop":"dragLeftDrop";return this.can(e,t)?!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.DISALLOWED):(this.state=this.states.DROP,this.#p(e,t)):this.#p(e,t,this.handlerOutcomes.DISALLOWED)}#a(t){this.cancel(t)}handleEvent(t){switch(t.type){case"pointerover":this.#e(t);break;case"pointerout":this.#n(t);break;case"pointerup":this.#r(t);break;case"pointerdown":2===t.button?this.#s(t):this.#i(t);break;default:return!1}return!0}cancel(t){const e=this._dragRight?"dragRightCancel":"dragLeftCancel",n=this.state;return n<=this.states.HOVER?this.#p(e,t,this.handlerOutcomes.SKIPPED):n>=this.states.DRAG&&!1===this.callback(e,t)?this.#p(e,t,this.handlerOutcomes.REFUSED):t.defaultPrevented?(this.state=this.states.DRAG,this.#p(e,t,this.handlerOutcomes.SKIPPED)):(this.interactionData={},this.state=this.states.HOVER,canvas.currentMouseManager=null,this.#g(),this.#p(e,t))}#p(t,e,n=this.handlerOutcomes.ACCEPTED){if(CONFIG.debug.mouseInteraction){const i=this.object.constructor.name,s=e.target?.constructor.name,{eventPhase:o,type:r,button:a}=e;let c=`${i} | ${t} | state:${Object.keys(this.states)[this.state.toString()]} | target:${s} | phase:${o} | type:${r} | btn:${a} | skipped:${n<=-2} | allowed:${n>-1} | handled:${n>1}`;console.debug(c)}}reset({interactionData:t=!0,state:e=!0}={}){CONFIG.debug.mouseInteraction&&console.debug(`${this.object.constructor.name} | Reset | interactionData:${t} | state:${e}`),t&&(this.interactionData={}),e&&(this.state=MouseInteractionManager.INTERACTION_STATES.NONE)}#l(t){this.interactionData.object=this.object,t.interactionData=this.interactionData;for(const e of Object.keys(this.interactionData))t.hasOwnProperty(e)||Object.defineProperty(t,e,{get(){const t=`event.data.${e} is deprecated in favor of event.interactionData.${e}.`;return foundry.utils.logCompatibilityWarning(t,{since:11,until:12}),this.interactionData[e]},set(t){const n=`event.data.${e} is deprecated in favor of event.interactionData.${e}.`;foundry.utils.logCompatibilityWarning(n,{since:11,until:12}),this.interactionData[e]=t}})}}let gt=null,pt=null;const ft=it.init();let mt=null,vt=!1;function yt(t){vt=t,t?document.body.classList.add("touchvtt-using-touch"):document.body.classList.remove("touchvtt-using-touch")}console.log(`${t} booting ...`),Hooks.on("getSceneControlButtons",(t=>{H(y)&&(function(t){const e=t.find((t=>"measure"===t.name));if(null!=e){const t=e.tools.findIndex((t=>"clear"===t.name));-1!==t&&e.tools.splice(t,0,{name:et,title:"TOUCHVTT.Erase",icon:"fas fa-eraser"})}}(t),function(t){const e=t.find((t=>"walls"===t.name));null!=e&&Array.isArray(e.tools)&&e.tools.push({name:"tile",title:"TOUCHVTT.ToggleWallChain",icon:"fas fa-link",toggle:!0,active:st,onClick:t=>st=t},{name:"undo",title:"TOUCHVTT.UndoWall",icon:"fas fa-undo",button:!0,onClick:()=>canvas.walls.undoHistory()},{name:"Delete",title:"TOUCHVTT.DeleteWall",icon:"fas fa-eraser",button:!0,onClick:()=>canvas.walls._onDeleteKey()})}(t),function(t){const e=t.find((t=>"drawings"===t.name));null!=e&&Array.isArray(e.tools)&&e.tools.push({name:"Delete",title:"TOUCHVTT.DeleteDrawing",icon:"fas fa-eraser",button:!0,onClick:()=>canvas.drawings._onDeleteKey()})}(t),function(t){const e=t.find((t=>"token"===t.name));null!=e&&e.tools.push({name:"snap",title:"TOUCHVTT.SnapToGrid",icon:"fas fa-border-all",toggle:!0,active:ot,onClick:t=>ot=t})}(t),function(t){if(game.user.isGM){const e=t.find((t=>"token"===t.name));if(null==e||!Array.isArray(e.tools))return;e.tools.push({name:"Delete",title:"TOUCHVTT.DeleteToken",icon:"fas fa-eraser",button:!0,onClick:()=>canvas.tokens._onDeleteKey()})}}(t))})),Hooks.on("renderSceneControls",(t=>{H(y)&&function(){$("#touch-vtt-controls").remove();var t=$("<div>").attr("id","touch-vtt-controls");game.user.isGM&&$("<button>").append($("<i>").addClass("fas").addClass(game.paused?"fa-play":"fa-pause")).attr("id","touch-vtt-togglepause").click((function(){game.paused?$(this).find("i").removeClass("fa-play").addClass("fa-pause"):$(this).find("i").removeClass("fa-pause").addClass("fa-play"),game.togglePause(!game.paused,!0)})).appendTo(t),$("#controls").prepend(t)}()})),Hooks.once("init",(()=>{game.settings.register(e,y+"_override",{name:"Core Functionality",hint:"Caution: disabling this option will remove all TouchVTT functionality, and other options will be ignored",scope:"world",config:!1,type:String,choices:{on:"On",off:"Off",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,b+"_override",{name:"Zoom / Pan Gestures",hint:"Select the gesture to use for zooming & panning the game canvas",scope:"world",config:!1,type:String,choices:{[E]:"Zoom & Pan with 2 fingers",[T]:"Zoom with 2 fingers, pan with 3 fingers",[_]:"No zoom or pan gestures",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,w+"_override",{name:"Direction arrows in Token HUD",hint:"Enables / disables the addition of arrow buttons used to rotate a token in the token's right-click menu",scope:"world",config:!1,type:String,choices:{[D]:"On",off:"Off",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,O+"_override",{name:"Targeting behavior",hint:"Controls if and how unowned tokens can be targeted via the touch interface",scope:"world",config:!1,type:String,choices:{[M]:"Disabled",[P]:"Allow single target",[C]:"Allow multiple targets",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,L+"_override",{name:"Measurement HUD",hint:"Shows a UI while measuring distance with the ruler, allowing you to set waypoints or move your token",scope:"world",config:!1,type:String,choices:{[k]:"Disabled",[R]:"Show right",[I]:"Show left",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,S+"_override",{name:"Enlarge buttons in on-screen UI",hint:"Increases the size of menu bar buttons to make them easier to use with touch controls",scope:"world",config:!1,type:String,choices:{on:"On",off:"Off",override_off:"Don't override"},default:"override_off"}),game.settings.register(e,y,{name:"Core Functionality",hint:"Caution: disabling this option will remove all TouchVTT functionality, and other options will be ignored",scope:"client",config:!0,requiresReload:!0,type:Boolean,default:!0}),game.settings.register(e,b,{name:"Zoom / Pan Gestures"+("override_off"==game.settings.get(e,b+"_override")?"":" *"),hint:"Select the gesture to use for zooming & panning the game canvas",scope:"client",config:!0,type:String,choices:{[E]:"Zoom & Pan with 2 fingers",[T]:"Zoom with 2 fingers, pan with 3 fingers",[_]:"No zoom or pan gestures"},default:E}),game.settings.register(e,x,{name:"Zoom Sensitivity",hint:"Sensitivity of the zoom gesture (if enabled)",scope:"client",config:!0,type:Number,range:{min:0,max:2,step:.1},default:1}),game.settings.register(e,w,{name:"Direction arrows in Token HUD"+("override_off"==game.settings.get(e,w+"_override")?"":" *"),hint:"Enables / disables the addition of arrow buttons used to rotate a token in the token's right-click menu",scope:"client",config:!0,type:String,choices:{[D]:"On",off:"Off"},default:D}),game.settings.register(e,O,{name:"Targeting behavior"+("override_off"==game.settings.get(e,O+"_override")?"":" *"),hint:"Controls if and how unowned tokens can be targeted via the touch interface",scope:"client",config:!0,type:String,choices:{[M]:"Disabled",[P]:"Allow single target",[C]:"Allow multiple targets"},default:P}),game.settings.register(e,L,{name:"Measurement HUD"+("override_off"==game.settings.get(e,L+"_override")?"":" *"),hint:"Shows a UI while measuring distance with the ruler, allowing you to set waypoints or move your token",scope:"client",config:!0,type:String,choices:{[k]:"Disabled",[R]:"Show right",[I]:"Show left"},default:R}),game.settings.register(e,S,{name:"Enlarge buttons in on-screen UI"+("override_off"==game.settings.get(e,S+"_override")?"":" *"),hint:"Increases the size of menu bar buttons to make them easier to use with touch controls",scope:"client",config:!0,type:Boolean,default:!1,onChange:t=>v(t)}),game.settings.register(e,A,{name:"Enable Debug Mode",hint:"Sends additional log messages to the developer console",scope:"client",config:!0,requiresReload:!0,type:Boolean,default:!1}),game.settings.registerMenu(e,"SettingsOverrideMenu",{name:"Client Settings Overrides",label:"Configure Overrides",hint:"Configure which client settings are forced by the GM.",icon:"fas fa-bars",type:N,restricted:!0}),Hooks.on("renderSettingsConfig",((t,n,i)=>{var s=i.categories.find((t=>t.id==e)).settings;let o=!1;s.forEach((t=>{let e=t.name.endsWith("*");n.find(`[name='${t.id}']`).prop("disabled",e),o|=e})),o&&n.find(`[data-tab='${e}'] h2`).after($("<small>").html("Some settings, indicated with an asterisk (*), are being overridden by the GM. The values selected here might not be accurate."))})),H(y)?(["renderDocumentDirectory","renderDirectoryApplication","changeSidebarTab"].forEach((t=>{Hooks.on(t,(function(t){mt.fixDirectoryScrolling(t,vt)}))})),function(){const t=document.createElement("style");t.setAttribute("id",f),document.head.append(t)}(),v(H(S)||!1),"function"==typeof TokenHUD&&"object"==typeof TokenHUD.prototype&&"function"==typeof TokenHUD.prototype.activateListeners&&o("TokenHUD.prototype.activateListeners",(function(t,e,...n){const i=t(e,...n);return H(w)!==D||ct()?.document?.lockRotation||function(t){const e=t.find(".col.left"),n=t.find(".col.middle"),i=t.find(".col.right");at(n,0),at(i,45),at(i,90),at(i,135),at(n,180),at(e,225),at(e,270),at(e,315)}(e),i})),ft.initMeasuredTemplateManagement(),game.release.generation<12&&o("WallsLayer.prototype._onDragLeftCancel",(function(t,...e){if(!(e[0]instanceof PointerEvent))return t(...e);e[0].preventDefault()}),"MIXED"),o("WallsLayer.prototype._onClickLeft",(function(t,...e){return t(...e),this._onDragLeftStart(...e)})),game.release.generation<12&&(MouseInteractionManager=dt),o("MouseInteractionManager.prototype.callback",(async function(t,e,...n){if(["touch","pen"].includes(n[0].pointerType)){if("touch"==n[0].pointerType){if(game.release.generation>=12&&"clickLeft2"==e)return await new Promise((t=>setTimeout(t,100))),document.getElementById("board").dispatchEvent(new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window,button:2})),t.call(this,e,...n);"clickLeft"==e?(clearTimeout(gt),clearTimeout(pt),gt=setTimeout((()=>{a(n[0],"pointerup"),a(n[0],"pointerdown",{button:2,buttons:2})}),400),pt=setTimeout((()=>{this.callbacks.longPress(n[0],n[0].interactionData.origin)}),1e3)):(clearTimeout(gt),clearTimeout(pt)),function(t,e){t.startsWith("dragLeft")&&!ot&&e.forEach((t=>{t.shiftKey=!0}))}(e,n)}if(function(t,e){if("clickLeft"==t){const n=e[0].target;rt()!==M&&"select"===game.activeTool&&n instanceof Token&&function(t,e){return"function"==typeof t.can&&!t.can("clickLeft",e)}(n.mouseInteractionManager,t)&&function(t){const e=rt()===P;t.setTarget(!t.isTargeted,{releaseOthers:e})}(n)}}(e,n),"longPress"!=e||n[1]||(n[1]=n[0].interactionData.origin),"dragLeftCancel"==e&&n[0]instanceof PointerEvent)return void n[0].preventDefault()}return t.call(this,e,...n)}),"MIXED"),o("game.keyboard.isModifierActive",(function(t,e){var n=t.call(this,e);return n||=function(t){return!(t!==KeyboardManager.MODIFIER_KEYS.CONTROL||"walls"!=ui.controls.activeControl||!st)}(e),n}),"MIXED"),mt=tt.init()):console.info(`${t} is active, but core functionality has been disabled in the settings.`)})),Hooks.on("ready",(function(){if(H(y))try{const e=document.querySelector("canvas#board")||document.querySelector("body > canvas")||document.querySelector("canvas");if(e){const n=B.init(e);(function({touchPointerEventsManager:t}){null==canvas.hud.touchMeasurement&&(canvas.hud.touchMeasurement=new lt({touchPointerEventsManager:t}),o("Ruler.prototype._onMouseMove",(function(t,e,...n){return null!=e.interactionData&&null!=e.interactionData.destination&&(game.release.generation<12?e.interactionData.destination.originType=e.pointerType:e.interactionData.destination.originType=e.data?.originalEvent?.pointerType),t.call(this,e,...n)})),o("Ruler.prototype.measure",(function(t,e,...n){const i=t.call(this,e,...n);if(Array.isArray(i)&&ht(this)&&ut()!==k&&"touch"===e?.originType)if(i.length>0){const t=i[i.length-1];canvas.hud.touchMeasurement.show(t.ray.B)}else canvas.hud.touchMeasurement.clear();return i})),o("Ruler.prototype.clear",(function(t,...e){const n=t.call(this,...e);return ht(this)&&canvas.hud.touchMeasurement.clear(),n})))})({canvasTouchPointerEventsManager:n}),ft.initMeasuredTemplateHud(n),game.release.generation<12&&(e.removeEventListener("pointerdown",canvas.app.renderer.events.onPointerDown,!0),o("canvas.app.renderer.events.onPointerDown",(function(t,...e){if("pen"!=e[0].pointerType)return t.call(this,...e)}),"MIXED"),e.addEventListener("pointerdown",canvas.app.renderer.events.onPointerDown,!0)),console.info(`${t} started successfully.`)}else console.warn(`Failed to find canvas element. ${t} will not be available.`);["pointerdown","pointerup"].forEach((t=>{document.body.addEventListener(t,(t=>{t.isTrusted&&("mouse"==t.pointerType?yt(!1):["touch","pen"].includes(t.pointerType)&&yt(!0))}),!0)}))}catch(e){console.error(`Failed to initialize ${t}: `,e)}H(A)&&["pointerdown","pointermove","pointerup","pointercancel","touchstart","touchmove","touchend"].forEach((e=>{document.body.addEventListener(e,(e=>{console.log(t+": "+e.type,e.pointerType,e.isTrusted,e)}),!0)}))}))})()})();